# <p align="center">국방 정보 체계 활용 초급간부 자동 시간표 편성 프로젝트 - PRD</p>

## 1. 개요 (Overview)

본 프로젝트는 초급간부 교육 과정을 운영하는 관리자가 최소한의 입력만으로 교육 일정을 자동으로 생성하고 검증할 수 있는 웹 애플리케이션을 구축하는 것을 목표로 한다. 현재는 엑셀 기반 수작업으로 시간표를 편성하면서 강사 일정과 공휴일을 모두 확인해야 해 오류와 누락이 잦고, 재배정이 빈번하게 발생한다. 이를 개선하기 위해 관리자는 교육 과목 정보와 강사 일정을 시스템에 입력하고, 정의된 규칙에 따라 자동으로 시간표를 생성한 뒤 캘린더 UI를 통해 즉시 검토·조정할 수 있어야 한다.

---

## 2. 목표 (Goals)

- **정확도**: 자동 생성된 일정이 강사/공휴일 충돌 없이 편성되는 비율을 98% 이상으로 유지한다.
- **효율**: 관리자 1명이 교육 과정 1개를 편성하는 데 걸리는 시간을 기존 평균 6시간에서 2시간 이내로 단축한다.
- **사용성**: 첫 주 사용자 설문(관리자 5명 이상)에서 캘린더 UI 사용성 만족도 4.0/5.0 이상을 기록한다.
- **확장성**: 동일 엔진으로 과정 유형 3종 이상을 재활용할 수 있도록 규칙 정의를 구성 요소화한다.

---

## 3. 사용자 페르소나 및 시나리오 (User Personas & Journeys)

- **교육 과정 관리자**
  - 역할: 교육 일정 편성 및 운영 총괄.
  - 주요 과업: 과목 정보 업로드, 강사/공휴일 관리, 자동 편성 실행, 예외 일정 수동 조정, 결과 확정.
  - 사용 빈도: 주 2~3회, 데스크톱 환경.
  - Pain Point: 일정 충돌 확인의 반복 업무, 강사 일정 변경 시 재편성 난이도.

- **강사**
  - 역할: 배정된 강의 확인, 개인 일정 등록.
  - 주요 과업: 개인 일정(출장, 교육 등) 등록 및 수정, 확정된 시간표 확인.
  - 사용 빈도: 주 1회 이하, 모바일/데스크톱 혼용.
  - Pain Point: 최신 일정 확인의 어려움, 일정 변경 시 관리자 연락 필요.

- **교육 총괄(감독)**
  - 역할: 전체 과정 진행 상황 모니터링 및 승인.
  - 주요 과업: 확정 전 시간표 검토, 주요 지표 확인, 엑셀/PDF 결과 자료 요청.
  - 사용 빈도: 과정당 1~2회, 데스크톱.
  - Pain Point: 자료 취합 소요 시간, 확정 기록 추적의 어려움.

주요 사용자 여정은 (1) 관리자 초기 설정 → (2) 강사/공휴일 데이터 확보 → (3) 자동 편성 → (4) 캘린더 검토 및 수동 조정 → (5) 총괄 승인 → (6) 결과 공유 순으로 진행된다.

---

## 4. 기능 요구사항 (Functional Requirements)

### 4.1. 데이터 입력 및 검증
- **[P0] 교과 엑셀 업로드**
  - 지정 템플릿(`subjects.xlsx`)을 통해 과목 정보를 업로드한다.
  - 필수 컬럼: `구분`, `과목명`, `총수업시간`, `담당교관`, `우선배정유형`, `평가여부`, `표시순서`.
  - 업로드 즉시 필드 형식/중복/필수값을 검증하고, 오류 항목은 행 단위로 UI에 표시한다.
  - 성공 시 SQLite DB에 저장하며, 파일 이력(업로드 일시, 업로더, 파일명)을 함께 기록한다.

- **[P0] 강사 정보 및 일정**
  - 강사 기본 정보 CRUD와 더불어 개인 일정(출장, 휴가 등)을 등록한다.
  - 반복 일정(주기 반복, 특정 요일 반복)을 지원하며, 중복·겹침 시 경고를 제공한다.

- **[P0] 공휴일 및 부분 휴무 등록**
  - 날짜/시간 단위 공휴일을 등록하고, 반복 규칙(연도 반복 등)을 설정할 수 있다.
  - 동일 기간 중복 등록 시 경고 및 병합 옵션을 제공한다.

- **[P1] API 연동**
  - 향후 국방 정보 체계 내 캘린더 API와의 연동을 고려해 REST API 인터페이스를 설계한다.

### 4.2. 자동 시간표 생성
- **[P0] 편성 실행**
  - 관리자는 `편성 실행` 버튼으로 자동 편성을 요청한다.
  - 편성 엔진은 과목 우선순위, 강사 일정, 공휴일, 시간대 규칙을 기반으로 배정한다.
  - 실행 후 요약 리포트(배정 수, 수동 필요 과목, 충돌 내역)를 제공한다.

- **[P0] 우선 배정 과목 처리 (`우선배정 = 1`)**
  - 필수 과목은 관리자가 캘린더에서 직접 시간대를 선택한다.
  - 자동 배정 결과 내에서 해당 시간 블록은 보호되어 재배정 시 덮어쓰지 않는다.

- **[P0] 일반 자동 배정 (`우선배정 = 2`)**
  - 우선 배정으로 지정되지 않은 과목은 규칙에 따라 자동 배정된다.
  - 과목별 요구 시간(`총수업시간`)을 소단위(45분)로 나누어 블록을 채운다.
  - 충돌 발생 시 대안 시간대 탐색 후 불가 시 수동 조정 필요 항목으로 표시한다.

- **[P0] 평가 일정 배치 (`평가여부 = 1`)**
  - 평가 과목은 마지막 강의일 이후 2교시에 자동 편성한다.
  - 동일 일자에 편성이 불가할 경우 다음 영업일의 2교시로 이동한다.
  - 평가 결과 기록용 이벤트(`evaluation`)가 별도로 생성된다.

- **[P1] 재편성/부분 편성**
  - 특정 과목 또는 기간만 재편성할 수 있는 옵션을 제공한다.
  - 자동 편성 중간 저장 상태를 유지하여 롤백 가능하도록 한다.

### 4.3. 일정 제약 및 예외 처리
- **[P0] 운영 시간대**
  - 하루 수업 시간: 08:00–17:30 (중식 11:35–13:00 제외).
  - 9교시: 08:05–11:35, 13:00–17:25 / 8교시: 08:40–11:15, 13:00–17:25 / 5교시: 08:40–11:15, 13:00–14:40.
  - 단위 수업 시간은 45분이며 지역 공휴일과 기관 지정 휴무를 준수한다.

- **[P0] 강사 일정 우선권**
  - 강사 개인 일정과 겹치는 시간대에는 자동 배정하지 않는다.
  - 일정 등록 이후 기존 시간표와 충돌할 경우 관리자에게 알림을 제공하고, 충돌 목록 화면에서 해결한다.

- **[P0] 공휴일/부분 휴무**
  - 공휴일 및 부분 휴무 시간대에는 수업을 배정하지 않는다.
  - 부분 휴무(예: O월 O일 14:00–18:00)는 해당 구간만 차단한다.

- **[P0] 오류 및 경고 처리**
  - 입력 데이터 오류(예: 강사 미존재, 과목 시간 과부족)는 사전 검증으로 차단한다.
  - 편성 실패 시 원인을 유형화하여 제공한다(강사 일정 부족, 시간대 부족 등).
  - 사용자는 오류 항목을 수정 후 재시도할 수 있다.

### 4.4. 수동 조정 및 승인 흐름
- **[P0] 캘린더 내 편집**
  - 드래그 앤 드롭으로 일정 이동, 길이 조정, 강사 교체가 가능하다.
  - 변경 시 충돌 검사 후 경고가 있을 경우 사용자 확인을 요구한다.
  - 변경 이력(변경자, 변경 시각, 변경 내용)을 기록한다.

- **[P0] 승인 프로세스**
  - 관리자가 시간표를 검토 후 `확정 요청`으로 교육 총괄에게 전달한다.
  - 총괄은 비교 뷰(자동 결과 vs. 수동 수정)를 확인하고 승인/반려를 선택한다.
  - 승인 후에는 편집이 제한되며, 재편성이 필요할 경우 별도 승인 취소가 필요하다.

- **[P1] 알림 및 통지**
  - 확정 시 강사에게 이메일/문자 알림을 발송할 수 있도록 외부 연동을 고려한다.

### 4.5. 결과 공유
- **[P0] 내보내기**
  - 시간표 결과를 엑셀/CSV로 추출하고, 강사별/과목별 시트를 제공한다.
  - 총괄용 요약 리포트(총 강의시간, 평가 일정, 미배정 항목)를 제공한다.

- **[P1] PDF 리포트**
  - 향후 표준 서식의 PDF 출력 기능을 제공한다.

---

## 5. 비기능 요구사항 (Non-Functional Requirements)

- **기술 스택**
  - 프런트엔드: React, TailwindCSS, react-big-calendar.
  - 백엔드: FastAPI (Python), Celery 기반 비동기 작업(편성 엔진) 검토.
  - 데이터베이스: SQLite (향후 PostgreSQL 전환 고려).

- **성능**
  - 자동 편성 요청 1건을 30초 이내에 완료한다.
  - 주요 화면 로딩 및 캘린더 전환은 2초 이내 응답한다.

- **보안 및 권한**
  - SSO 또는 기관 계정 연동을 고려한 인증 구조.
  - 역할 기반 접근 제어(RBAC): 관리자, 강사, 총괄 권한.
  - 모든 변경 작업은 감사 로그에 기록한다.

- **운영 및 유지보수**
  - 개발/검증/운영 3개 환경 구성, SQLite는 개발·검증에 한정 사용.
  - 주간 백업 및 롤백 절차 정의.
  - 단위/통합/부하 테스트 시나리오 제공, 편성 엔진 회귀 테스트 자동화.

- **접근성**
  - 키보드 내비게이션, 명도 대비 준수, 스크린리더용 레이블 제공.

---

## 6. 시스템 아키텍처 (System Architecture)

- **프런트엔드 (Client)**
  - React 기반 SPA로 구성되며 React Query로 데이터 페칭/캐싱을 처리한다.
  - 캘린더 UI는 `react-big-calendar` 커스터마이징 버전을 사용한다.
  - 오류/성공 토스트, 로딩 인디케이터, 빈 상태 메시지를 통일된 디자인 시스템으로 제공한다.

- **백엔드 (Server)**
  - FastAPI 기반 REST API.
  - 엑셀 업로드 파이프라인, 자동 편성 엔진, 권한 검증을 포함한다.
  - 비동기 편성 작업은 Celery + Redis 큐(또는 FastAPI BackgroundTask)로 처리한다.

- **데이터베이스 (DB)**
  - SQLite를 시작으로, 동시성 요구 시 RDBMS 전환을 고려한다.
  - 정규화된 테이블 구조와 인덱스 전략, 외래키 제약을 명시한다.

- **외부 연동**
  - 국방 정보 체계와의 SSO/캘린더 연동은 추후 API 명세 확보 후 확장한다.

---

## 7. 데이터 모델 (Data Model)

1. **subjects (교과)**
   - `id` (PK, INTEGER)
   - `category` (TEXT)
   - `name` (TEXT, UNIQUE)
   - `total_hours` (INTEGER)
   - `instructor_id` (FK → instructors.id, NULLABLE)
   - `priority_type` (INTEGER: 1=우선배정, 2=자동배정)
   - `has_evaluation` (BOOLEAN)
   - `display_order` (INTEGER)
   - `created_at` / `updated_at` (DATETIME)

2. **instructors (교관)**
   - `id` (PK, INTEGER)
   - `name` (TEXT, UNIQUE)
   - `rank` (TEXT, NULLABLE)
   - `phone` (TEXT, NULLABLE)
   - `default_availability` (JSON, NULLABLE) — 요일별 기본 가능 시간대
   - 감사 필드: `created_at`, `updated_at`

3. **instructor_schedules (교관 일정)**
   - `id` (PK, INTEGER)
   - `instructor_id` (FK)
   - `start_time` (DATETIME)
   - `end_time` (DATETIME)
  - `repeat_rule` (TEXT, NULLABLE) — 반복 일정 정의(예: RRULE)
   - `reason` (TEXT)
   - 겹침 방지를 위한 유니크 제약 및 상태(`active`, `cancelled`)

4. **holidays (휴무)**
   - `id` (PK, INTEGER)
   - `date` (DATE)
   - `name` (TEXT)
   - `start_time` (TIME, NULLABLE)
   - `end_time` (TIME, NULLABLE)
   - `repeat_rule` (TEXT, NULLABLE)
   - `created_at`, `updated_at`

5. **timetable (자동 편성 결과)**
   - `id` (PK, INTEGER)
   - `subject_id` (FK → subjects.id)
   - `event_type` (TEXT: `class`, `evaluation`)
   - `start_time` (DATETIME)
   - `end_time` (DATETIME)
   - `instructor_id` (FK → instructors.id)
   - `status` (TEXT: `draft`, `confirmed`, `cancelled`)
   - `created_by` (TEXT)
   - `created_at`, `updated_at`

6. **generation_jobs (편성 작업 이력)**
   - `id` (PK, INTEGER)
   - `requested_by` (TEXT)
   - `requested_at` (DATETIME)
   - `status` (TEXT: `pending`, `running`, `completed`, `failed`)
   - `summary` (JSON) — 충돌 수, 미배정 과목 등

7. **audit_logs (감사 로그)**
   - 데이터 변경 이벤트를 기록 (테이블명, 레코드 ID, 변경자, 변경 내용 스냅샷).

모든 시간 정보는 KST(UTC+9)를 기준으로 저장하며, 확장성을 위해 타임존 필드 추가를 고려한다.

---

## 8. UI/UX 요구사항 (UI/UX Requirements)

- **페이지 구조**
  - `/`: 로그인 및 시스템 소개 화면.
  - `/dashboard`: 관리자 대시보드(편성 진행 상태, 최근 작업 로그).
  - `/manage/subjects`: 과목 목록/업로드/검증.
  - `/manage/instructors`: 강사 정보 및 일정 관리.
  - `/manage/holidays`: 공휴일/휴무 관리.
  - `/schedule`: 캘린더 기반 시간표 편집 화면.
  - `/approvals`: 승인 요청 및 이력 확인 화면.

- **캘린더 UX**
  - 일/주/월 뷰 제공, 과목별 색상 테마.
  - 이벤트 카드에는 과목명, 강사, 세부 정보(평가 여부, 우선 배정 여부)를 표시.
  - 빈 상태, 로딩 상태, 에러 상태에 대한 안내 문구 제공.
  - 모바일에서는 주간/목록 뷰 중심으로 제공.

- **폼 UX**
  - 즉시 검증(Inline Validation), 오류 메시지는 한국어로 구체적으로 표기.
  - 템플릿 다운로드, 최근 업로드 내역, 업로드 성공/실패 히스토리를 제공.

- **접근성**
  - WCAG 2.1 AA 기준 준수, 키보드 포커스 표시, ARIA 레이블 제공.

---

## 9. 운영 계획 (Operations)

- **배포 프로세스**
  - Git 기반 브랜치 전략(예: GitFlow)과 CI/CD 파이프라인 구성.
  - 개발/검증/운영 환경 분리, 운영 반영 시 승인 절차 필요.

- **모니터링**
  - 애플리케이션 로그, 편성 성공률, 평균 처리 시간, 실패 건수 지표를 수집.
  - 경고 임계값 설정(예: 편성 실패율 5% 이상 시 알림).

- **사용자 지원**
  - 관리자/강사용 매뉴얼, 영상 튜토리얼 제공.
  - 1선 지원 담당자 지정 및 Q&A 채널 운영.

---

## 10. 향후 개선 과제 (Future Improvements)

- **다중 과정 지원**: 복수 교육 과정을 동시에 운영하고 자원 충돌을 자동으로 해결.
- **외부 캘린더 연동**: 국방 정보 체계 캘린더 혹은 Outlook/Google Calendar와 양방향 동기화.
- **알림 채널 확대**: 메신저/모바일 앱 푸시 연동으로 즉시 통지.
- **최적화 엔진 고도화**: 우선순위 가중치, 휴먼팩터(연속 강의 제한) 등을 고려한 고급 스케줄링.
- **시뮬레이션**: 가정 시나리오(강사 추가, 공휴일 변경) 기반 영향도 분석 기능.
